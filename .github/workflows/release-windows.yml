name: Build NST Windows

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-windows:
    runs-on: windows-latest
    env:
      QT_VERSION: 6.9.2
      QT_ARCH: win64_msvc2022_64
      BUILD_TYPE: Release

    steps:
      # Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4

      # Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.12

      # Install aqt (Qt installer)
      - name: Install aqtinstall
        run: python -m pip install --upgrade pip && pip install aqtinstall

      # Install Qt
      - name: Install Qt
        run: python -m aqt install-qt windows desktop $Env:QT_VERSION $Env:QT_ARCH --outputdir Qt --autodesktop

      # Set CMAKE_PREFIX_PATH to Qt cmake folder
      - name: Set Qt environment for CMake
        run: |
          echo "CMAKE_PREFIX_PATH=$PWD/Qt/$Env:QT_VERSION/$Env:QT_ARCH/lib/cmake/Qt6" >> $GITHUB_ENV

      # Configure CMake
      - name: Configure CMake
        run: cmake -B build -S . -DCMAKE_BUILD_TYPE=$Env:BUILD_TYPE -DCMAKE_PREFIX_PATH=$Env:CMAKE_PREFIX_PATH

      # Build project
      - name: Build Project
        run: cmake --build build --config $Env:BUILD_TYPE

      # Run tests (optional)
      # - name: Run tests
      #   run: ctest --test-dir build --config $Env:BUILD_TYPE

      # Package with CPack (optional)
      # - name: Package
      #   run: cmake --install build --prefix package
